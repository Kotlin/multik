def cmake_path = "${rootDir}/multik-native/multik_jni"
def path_to_build = file("${buildDir}/cmake-build")

def cmake_c_compiler = System.getenv("CMAKE_C_COMPILER") ?: "gcc"
def cmake_cxx_compiler = System.getenv("CMAKE_CXX_COMPILER") ?: "g++"
def lib_gcc_path = System.getenv("GCC_LIB_Path") ?: ""

task createBuildDir() {
    mkdir(project.buildDir)
    mkdir(file("${project.buildDir}/cmake-build"))
}

task config_cmake(dependsOn: createBuildDir) {
    def type_build = "-DCMAKE_BUILD_TYPE=Release"
    def gen = "CodeBlocks - Unix Makefiles"
    def c_compiler = "-DCMAKE_C_COMPILER=$cmake_c_compiler"
    def cxx_compiler = "-DCMAKE_CXX_COMPILER=$cmake_cxx_compiler"
    def path_to_gcc_lib = "-DGCC_LIB_PATH=$lib_gcc_path"
    doLast {
        exec {
            commandLine("cmake",
                    type_build,
                    c_compiler,
                    cxx_compiler,
                    path_to_gcc_lib,
                    "-G", gen,
                    "-S", cmake_path,
                    "-B", path_to_build,
            )
        }
    }

}


task build_cmake(dependsOn: config_cmake) {
    doLast {
        exec {
            commandLine("cmake", "--build", path_to_build, "--target", "multik_jni", "--", "-j", "12")
        }
    }
}